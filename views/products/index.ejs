<%- include('../partials/header') %>
<div class="container">
  <h2 class="mt-4 mb-3">Products</h2>
  <form class="row g-2 mb-3" method="GET" action="/products">
    <div class="col-md-6">
      <input name="q" class="form-control" placeholder="Search product or supplier" value="<%= q || '' %>">
    </div>
    <div class="col-md-2">
      <button type="submit" class="btn btn-primary">Search</button>
    </div>
    <% if (q) { %>
      <div class="col-md-2">
        <a href="/products" class="btn btn-secondary">Clear</a>
      </div>
    <% } %>
  </form>
  <% if (currentUser && currentUser.role === 'admin') { %>
    <a href="/products/new" class="btn btn-success mb-3">Add Product</a>
  <% } %>
  <div class="table-responsive">
    <table class="table table-bordered table-hover">
      <thead class="table-dark">
        <tr><th>Name</th><th>Price</th><th>Quantity</th><th>Supplier</th><th>Actions</th></tr>
      </thead>
      <tbody>
        <% products.forEach(p => { %>
          <tr>
            <td><%= p.name %></td>
            <td><%= p.price %></td>
            <td><%= p.quantity %></td>
            <td><%= p.supplierId ? p.supplierId.name : '' %></td>
            <td>
              <% if (currentUser && currentUser.role === 'admin') { %>
                <a href="/products/<%= p._id %>/edit" class="btn btn-sm btn-warning me-1">Edit</a>
                <form action="/products/<%= p._id %>?_method=DELETE" method="POST" style="display:inline;">
                  <button type="submit" class="btn btn-sm btn-danger">Delete</button>
                </form>
              <% } %>
            </td>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>
</div>
<%- include('../partials/footer') %>